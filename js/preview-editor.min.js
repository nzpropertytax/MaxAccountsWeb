(function(){"use strict";var n={apiBase:"",pendingChanges:[],init:function(){document.body.classList.add("preview-mode");this.createToolbar();this.attachEditHandlers();window.addEventListener("message",this.handleMessage.bind(this));window.parent!==window&&window.parent.postMessage({type:"preview-ready",url:window.location.href},"*")},createToolbar:function(){var n=document.createElement("div");n.className="preview-editor-toolbar";n.innerHTML='<strong>&#x270F;&#xFE0F; Preview Editor<\/strong><span>Click any highlighted element to edit<\/span><button onclick="PreviewEditor.saveAllChanges()" class="primary">&#x1F4BE; Save Changes (<span id="change-count">0<\/span>)<\/button><button onclick="PreviewEditor.discardChanges()">&#x2715; Discard<\/button><span class="status" id="editor-status">Ready<\/span>';document.body.insertBefore(n,document.body.firstChild)},attachEditHandlers:function(){var n=this;document.querySelectorAll("[data-editable]").forEach(function(t){t.addEventListener("click",function(i){i.preventDefault();i.stopPropagation();n.openEditor(t)})})},openEditor:function(n){var t=n.dataset.field||"text";t==="image"?this.openImageEditor(n):this.openTextEditor(n)},openTextEditor:function(n){var i=this,t=n.innerText||n.textContent,r=n.tagName==="P"||n.tagName==="DIV"||t.length>100,u='<div class="preview-editor-field"><label>Content:<\/label>'+(r?'<textarea id="edit-value">'+this.escapeHtml(t)+"<\/textarea>":'<input type="text" id="edit-value" value="'+this.escapeHtml(t)+'">')+"<\/div>";this.createModal("Edit Content",u,function(){var r=document.getElementById("edit-value").value;r!==t&&(n.innerText=r,n.classList.add("editing"),i.trackChange(n,"text",t,r));i.closeModal()})},openImageEditor:function(n){var r=this,u=n.src||n.dataset.imageSrc,t=n.style.objectFit||"cover",i=n.style.objectPosition||"center center",f='<div class="preview-editor-field"><label>Image Source:<\/label><input type="text" id="edit-src" value="'+u+'"><\/div><div class="preview-editor-field"><label>Fit Mode:<\/label><select id="edit-fit"><option value="cover"'+(t==="cover"?" selected":"")+'>Cover<\/option><option value="contain"'+(t==="contain"?" selected":"")+'>Contain<\/option><option value="fill"'+(t==="fill"?" selected":"")+'>Fill<\/option><option value="none"'+(t==="none"?" selected":"")+'>None<\/option><\/select><\/div><div class="preview-editor-field"><label>Position:<\/label><div class="image-position-grid"><button type="button" data-pos="top left">&#x2196;<\/button><button type="button" data-pos="top center">&#x2191;<\/button><button type="button" data-pos="top right">&#x2197;<\/button><button type="button" data-pos="center left">&#x2190;<\/button><button type="button" data-pos="center center">&#x25CF;<\/button><button type="button" data-pos="center right">&#x2192;<\/button><button type="button" data-pos="bottom left">&#x2199;<\/button><button type="button" data-pos="bottom center">&#x2193;<\/button><button type="button" data-pos="bottom right">&#x2198;<\/button><\/div><\/div>';this.createModal("Edit Image",f,function(){var f=document.getElementById("edit-src").value,e=document.getElementById("edit-fit").value,o=document.querySelector(".image-position-grid button.active"),s=o?o.dataset.pos:i;n.src=f;n.style.objectFit=e;n.style.objectPosition=s;n.classList.add("editing");r.trackChange(n,"image",{src:u,fit:t,position:i},{src:f,fit:e,position:s});r.closeModal()});document.querySelectorAll(".image-position-grid button").forEach(function(n){n.dataset.pos===i&&n.classList.add("active");n.addEventListener("click",function(t){t.preventDefault();document.querySelectorAll(".image-position-grid button").forEach(function(n){n.classList.remove("active")});n.classList.add("active")})})},createModal:function(n,t,i){var u,e,r,f;return this.closeModal(),u=document.createElement("div"),u.className="preview-editor-overlay",e=this,u.onclick=function(){e.closeModal()},r=document.createElement("div"),r.className="preview-editor-modal",r.innerHTML='<div class="preview-editor-modal-header">'+n+'<\/div><div class="preview-editor-modal-body">'+t+'<\/div><div class="preview-editor-modal-footer"><button type="button" onclick="PreviewEditor.closeModal()">Cancel<\/button> <button type="button" class="primary" id="modal-save">Save<\/button><\/div>',document.body.appendChild(u),document.body.appendChild(r),document.getElementById("modal-save").onclick=i,f=r.querySelector("input, textarea"),f&&f.focus(),r},closeModal:function(){document.querySelectorAll(".preview-editor-modal, .preview-editor-overlay").forEach(function(n){n.remove()})},trackChange:function(n,t,i,r){this.pendingChanges.push({element:n,type:t,entityType:n.dataset.entityType,entityId:n.dataset.entityId,field:n.dataset.field,oldValue:i,newValue:r,timestamp:(new Date).toISOString()});document.getElementById("change-count").textContent=this.pendingChanges.length},saveAllChanges:function(){if(this.pendingChanges.length===0){this.setStatus("No changes to save");return}this.setStatus("Saving...");window.parent!==window&&window.parent.postMessage({type:"save-changes",changes:this.pendingChanges.map(function(n){return{entityType:n.entityType,entityId:n.entityId,field:n.field,value:n.newValue}})},"*");this.pendingChanges=[];document.getElementById("change-count").textContent="0";document.querySelectorAll(".editing").forEach(function(n){n.classList.remove("editing")});this.setStatus("Saved!")},discardChanges:function(){this.pendingChanges.forEach(function(n){n.type==="text"?n.element.innerText=n.oldValue:n.type==="image"&&(n.element.src=n.oldValue.src,n.element.style.objectFit=n.oldValue.fit,n.element.style.objectPosition=n.oldValue.position);n.element.classList.remove("editing")});this.pendingChanges=[];document.getElementById("change-count").textContent="0";this.setStatus("Changes discarded")},setStatus:function(n){document.getElementById("editor-status").textContent=n},handleMessage:function(n){var t=n.data;t.type==="set-api-base"&&(this.apiBase=t.apiBase)},escapeHtml:function(n){var t=document.createElement("div");return t.textContent=n,t.innerHTML}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){n.init()}):n.init();window.PreviewEditor=n})()