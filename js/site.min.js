window.cookieConsent={init:function(){const n=document.getElementById("cookieConsentBanner");if(n){const t=localStorage.getItem("cookieConsent");t||(n.style.display="block")}},accept:function(){localStorage.setItem("cookieConsent","accepted");const n=document.getElementById("cookieConsentBanner");n&&(n.style.display="none")},decline:function(){localStorage.setItem("cookieConsent","declined");const n=document.getElementById("cookieConsentBanner");n&&(n.style.display="none")}};window.seoAnalyzer={isExpanded:!1,isLoading:!1,init:function(){const n=document.getElementById("seoPagePath");if(n){const t=window.location.pathname;n.textContent=t==="/"?"Home":t}},toggle:function(){const t=document.getElementById("seoAnalyzerTab"),n=document.getElementById("seoAnalyzerPanel");if(t&&n)if(this.isExpanded=!this.isExpanded,this.isExpanded){t.classList.add("hidden");n.classList.remove("collapsed");n.classList.add("expanded");const i=document.getElementById("seoChecklist");i&&i.style.display==="none"&&this.analyze()}else t.classList.remove("hidden"),n.classList.remove("expanded"),n.classList.add("collapsed")},analyze:async function(){if(!this.isLoading){this.isLoading=!0;const i=document.getElementById("seoStartState"),t=document.getElementById("seoLoadingState"),r=document.getElementById("seoErrorState"),u=document.getElementById("seoChecklist"),f=document.getElementById("seoSuggestions"),o=document.getElementById("seoScoreBanner"),n=document.getElementById("seoRefreshBtn");i&&(i.style.display="none");r&&(r.style.display="none");u&&(u.style.display="none");f&&(f.style.display="none");t&&(t.style.display="flex");n&&(n.disabled=!0,n.innerHTML='<i class="fa fa-spinner fa-spin"><\/i>');try{const t=this.gatherPageData(),n=await fetch("/api/ai/analyze-seo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok){const t=await n.json();this.displayResults(t)}else if(n.status===401){const n=document.getElementById("seoAnalyzerTab"),t=document.getElementById("seoAnalyzerPanel");n&&(n.style.display="none");t&&(t.style.display="none")}else this.showError("Failed to analyze page. Please try again.")}catch(e){this.showError("Error: "+e.message)}finally{this.isLoading=!1;t&&(t.style.display="none");n&&(n.disabled=!1,n.innerHTML='<i class="fa fa-sync-alt"><\/i>')}}},gatherPageData:function(){const n=window.location.origin+"/";return{url:window.location.href,title:document.title,description:document.querySelector('meta[name="description"]')?.content||null,keywords:document.querySelector('meta[name="keywords"]')?.content||null,h1:document.querySelector("h1")?.innerText||null,h1Count:document.querySelectorAll("h1").length,h2Count:document.querySelectorAll("h2").length,h3Count:document.querySelectorAll("h3").length,content:document.querySelector("main")?.innerText||document.body.innerText,imageCount:document.querySelectorAll("main img, .page-container img").length,imagesWithAlt:[...document.querySelectorAll("main img, .page-container img")].filter(n=>n.alt&&n.alt.trim()).length,internalLinks:[...document.querySelectorAll("main a, .page-container a")].filter(t=>t.href.startsWith(n)).length,externalLinks:[...document.querySelectorAll("main a, .page-container a")].filter(t=>!t.href.startsWith(n)&&t.href.startsWith("http")).length,isNoIndex:document.querySelector('meta[name="robots"][content*="noindex"]')!==null}},showError:function(n){const t=document.getElementById("seoErrorState"),i=document.getElementById("seoErrorMessage");t&&(t.style.display="flex");i&&(i.textContent=n)},displayResults:function(n){const t=document.getElementById("seoScoreBanner"),f=document.getElementById("seoScoreValue"),e=document.getElementById("seoScoreGrade"),o=document.getElementById("seoScoreLabel");t&&(t.style.display="flex",t.className="seo-score-banner "+this.getScoreClass(n.score));f&&(f.textContent=n.score);e&&(e.textContent=n.grade);o&&(o.textContent=this.getScoreLabel(n.score));const i=document.getElementById("seoChecklist");i&&(i.innerHTML=this.buildChecklistHtml(n),i.style.display="flex");const r=document.getElementById("seoSuggestions");r&&n.suggestions&&n.suggestions.length>0&&(r.innerHTML=this.buildSuggestionsHtml(n.suggestions),r.style.display="block");const u=document.getElementById("seoAnalyzerTab");if(u){const t=u.querySelector(".seo-tab-score");t&&t.remove();const r=`<div class="seo-tab-score ${this.getScoreClass(n.score)}">
                <span class="score-letter">${n.grade}</span>
                <span class="score-number">${n.score}</span>
            </div>`,i=u.querySelector(".seo-tab-arrow");i&&i.insertAdjacentHTML("beforebegin",r)}},buildChecklistHtml:function(n){const i=n.metadata||{},t=n.content||{};let r="";r+=this.buildCheckItem("Page Title",i.title?`${i.titleLength} characters`:null,i.title?"(optimal: 30-60)":null,i.title?this.truncateText(i.title,60):null,i.isTitleOptimal,!i.title,i.isTitleOptimal?"Good":i.title?"Improve":"Missing",i.title?null:"Missing title tag");r+=this.buildCheckItem("Meta Description",i.description?`${i.descriptionLength} characters`:null,i.description?"(optimal: 120-160)":null,i.description?this.truncateText(i.description,80):null,i.isDescriptionOptimal,!i.description,i.isDescriptionOptimal?"Good":i.description?"Improve":"Missing",i.description?null:"Missing description");const u=t.h1Count===1?"Good":t.h1Count===0?"Missing":"Too Many",f=t.h1Count===0?"No H1 heading found":t.h1Count===1?"1 H1 heading (perfect)":`${t.h1Count} H1 headings (should be 1)`;r+=this.buildCheckItem("H1 Heading",f,null,null,t.h1Count===1,t.h1Count===0,u);const e=t.wordCount>=600?"Excellent":t.wordCount>=300?"Good":t.wordCount>=100?"Thin":"Too Short";r+=this.buildCheckItem("Content Length",`${t.wordCount} words`,"(recommended: 300+)",null,t.wordCount>=300,t.wordCount<100,e,null,Math.min(100,t.wordCount/6));const o=t.imageCount===0?"None":t.imagesWithAlt===t.imageCount?"Good":"Missing Alt";r+=this.buildCheckItem("Images",t.imageCount===0?"No images found":`${t.imagesWithAlt}/${t.imageCount} with alt text`,null,null,t.imageCount>0&&t.imagesWithAlt===t.imageCount,t.imageCount>0&&t.imagesWithAlt<t.imageCount,o);const s=t.internalLinks>2?"Good":t.internalLinks>0?"OK":"None";return r+=this.buildCheckItem("Internal Links",`${t.internalLinks} internal links found`,null,null,t.internalLinks>0,!1,s),r+=this.buildCheckItem("Meta Keywords",i.hasKeywords?`${(i.keywords||[]).length} keywords defined`:"No keywords defined",null,null,i.hasKeywords,!1,i.hasKeywords?"Good":"None"),i.isNoIndex&&(r+=`<div class="seo-check-item status-critical">
                <div class="check-icon"><i class="fa fa-exclamation-triangle"></i></div>
                <div class="check-content">
                    <div class="check-title">Indexing Blocked</div>
                    <div class="check-detail"><span class="text-danger">This page has noindex set and won't appear in search results</span></div>
                </div>
                <div class="check-status"><span class="badge bg-danger">NoIndex</span></div>
            </div>`),r},buildCheckItem:function(n,t,i,r,u,f,e,o,s){const c=f?"status-critical":u?"status-good":"status-warning",l=f?"fa-times-circle":u?"fa-check-circle":"fa-exclamation-circle",a=e==="Good"||e==="Excellent"?"bg-success":e==="Missing"||e==="Too Short"?"bg-danger":e==="None"||e==="OK"?"bg-secondary":"bg-warning text-dark";let h=`<div class="seo-check-item ${c}">
            <div class="check-icon"><i class="fa ${l}"></i></div>
            <div class="check-content">
                <div class="check-title">${n}</div>
                <div class="check-detail">`;if(o?h+=`<span class="text-danger">${o}</span>`:t&&(h+=`<span>${t}</span>`,i&&(h+=`<span class="optimal-range">${i}</span>`)),h+="<\/div>",r&&(h+=`<div class="check-value">${r}</div>`),s!==undefined){const n=s>=100?"bg-success":s>=50?"bg-info":s>=25?"bg-warning":"bg-danger";h+=`<div class="check-progress"><div class="progress" style="height: 6px;"><div class="progress-bar ${n}" style="width: ${s}%"></div></div></div>`}return h+=`</div>
            <div class="check-status"><span class="badge ${a}">${e}</span></div>
        </div>`},buildSuggestionsHtml:function(n){let t=`<div class="section-header"><i class="fa fa-lightbulb me-2"></i>Suggestions (${n.length})</div>
            <div class="suggestions-list">`;for(const i of n)t+=`<div class="suggestion-item ${i.priority||""}">
                <div class="suggestion-priority-indicator"></div>
                <div class="suggestion-content">
                    <div class="suggestion-title">${i.title||""}</div>
                    <div class="suggestion-desc">${i.description||""}</div>`,i.suggestedValue&&(t+=`<div class="suggestion-value-box">
                    <code>${this.truncateText(i.suggestedValue,100)}</code>
                    <button class="copy-btn" onclick="navigator.clipboard.writeText('${i.suggestedValue.replace(/'/g,"\\'")}')" title="Copy">
                        <i class="fa fa-copy"></i>
                    </button>
                </div>`),t+="<\/div><\/div>";return t+="<\/div>"},getScoreClass:function(n){return n>=90?"score-excellent":n>=80?"score-good":n>=70?"score-fair":n>=60?"score-poor":"score-critical"},getScoreLabel:function(n){return n>=90?"Excellent":n>=80?"Good":n>=70?"Fair":n>=60?"Needs Work":"Poor"},truncateText:function(n,t){return n?n.length<=t?n:n.substring(0,t-3)+"...":""}};window.hoverDropdown={init:function(){if(!(window.innerWidth<576)){const n=document.querySelectorAll(".navbar .hover-dropdown");n.forEach(function(n){const t=n.querySelector(".dropdown-menu"),i=n.querySelector(".dropdown-toggle");let r;n.addEventListener("mouseenter",function(){clearTimeout(r);t&&(t.classList.add("show"),i&&i.setAttribute("aria-expanded","true"))});n.addEventListener("mouseleave",function(){r=setTimeout(function(){t&&(t.classList.remove("show"),i&&i.setAttribute("aria-expanded","false"))},100)})})}}};document.addEventListener("DOMContentLoaded",function(){window.cookieConsent.init();window.seoAnalyzer.init();window.hoverDropdown.init();window.adminSubmenu.init()});window.adminSubmenu={init:function(){this.initAdminDropdownHover();this.initSubmenus()},initAdminDropdownHover:function(){const n=document.querySelector(".btn-group:has(.admin-mega-menu)");if(n){const t=n.querySelector('[data-bs-toggle="dropdown"]'),i=n.querySelector(".admin-mega-menu");if(t&&i&&!(window.innerWidth<992)){let r;n.addEventListener("mouseenter",function(){clearTimeout(r);i.classList.add("show");t.classList.add("show");t.setAttribute("aria-expanded","true")});n.addEventListener("mouseleave",function(){r=setTimeout(function(){i.classList.remove("show");t.classList.remove("show");t.setAttribute("aria-expanded","false");i.querySelectorAll(".dropdown-submenu.show").forEach(function(n){n.classList.remove("show")})},150)});i.addEventListener("click",function(n){n.target.closest(".dropdown-submenu > .dropdown-item")&&n.stopPropagation()})}}},initSubmenus:function(){const n=document.querySelectorAll(".dropdown-submenu");n.forEach(function(n){const t=n.querySelector(":scope > .dropdown-item"),i=n.querySelector(":scope > .dropdown-menu");t&&i&&(window.innerWidth<992?t.addEventListener("click",function(t){t.preventDefault();t.stopPropagation();const r=n.classList.contains("show"),i=n.parentElement;i&&i.querySelectorAll(":scope > .dropdown-submenu.show").forEach(function(t){t!==n&&t.classList.remove("show")});n.classList.toggle("show",!r)}):n.addEventListener("mouseenter",function(){window.adminSubmenu.positionSubmenu(i)}))})},positionSubmenu:function(n){!n||window.innerWidth<992||(n.classList.remove("dropdown-menu-start"),requestAnimationFrame(function(){const t=n.getBoundingClientRect(),r=window.innerWidth;t.right>r-10&&n.classList.add("dropdown-menu-start");const i=window.innerHeight;if(t.bottom>i-10){const r=t.bottom-i+20,u=Math.max(-10,parseFloat(getComputedStyle(n).top)-r);n.style.top=u+"px"}}))}}